<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RListExcel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">citizensLoader4a</a> &gt; <a href="index.source.html" class="el_package">es.uniovi.asw.parser</a> &gt; <span class="el_source">RListExcel.java</span></div><h1>RListExcel.java</h1><pre class="source lang-java linenums">package es.uniovi.asw.parser;

import es.uniovi.asw.model.Citizen;
import es.uniovi.asw.util.Console;
import es.uniovi.asw.util.exception.CitizenException;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.xssf.usermodel.XSSFSheet;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;

import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Date;
import java.util.Iterator;
import java.util.List;

/**
 * Implementación de lector excel
 */
<span class="fc" id="L20">public class RListExcel extends RList implements ReadList {</span>


	@Override
	public List&lt;Citizen&gt; readFile(String path) throws CitizenException {

<span class="fc" id="L26">		XSSFWorkbook wb = null;</span>
<span class="fc" id="L27">		XSSFSheet sheet = null;</span>
<span class="fc" id="L28">		Iterator&lt;Row&gt; rowIterator = null;</span>
<span class="fc" id="L29">		Row row = null;</span>
<span class="fc" id="L30">		List&lt;Citizen&gt; ciudadanos = new ArrayList&lt;Citizen&gt;();</span>

		String name;
		String surname;
		String email;
		Date birth;
		String address, nationality,nif;

<span class="fc" id="L38">		int colNombre = 0;</span>
<span class="fc" id="L39">		int colApellido = 0;</span>
<span class="fc" id="L40">		int colEmail = 0;</span>
<span class="fc" id="L41">		int colBirth = 0;</span>
<span class="fc" id="L42">		int colAddress = 0;</span>
<span class="fc" id="L43">		int colNacionalidad = 0;</span>
<span class="fc" id="L44">		int colNif = 0;</span>


		try {
<span class="fc" id="L48">			wb = new XSSFWorkbook(new File(path));</span>
<span class="fc" id="L49">			sheet = wb.getSheetAt(0);</span>
<span class="fc" id="L50">			rowIterator = sheet.iterator();</span>
<span class="fc" id="L51">			int columna = 0;</span>
<span class="fc" id="L52">			row = rowIterator.next();</span>
<span class="fc bfc" id="L53" title="All 2 branches covered.">			while (columna &lt; 7) {</span>
<span class="fc" id="L54">				String celda = row.getCell(columna).getStringCellValue();</span>
<span class="fc bfc" id="L55" title="All 2 branches covered.">				if (celda.startsWith(&quot;No&quot;))</span>
<span class="fc" id="L56">					colNombre = columna;</span>
<span class="fc bfc" id="L57" title="All 2 branches covered.">				else if (celda.startsWith(&quot;Ap&quot;))</span>
<span class="fc" id="L58">					colApellido = columna;</span>
<span class="fc bfc" id="L59" title="All 4 branches covered.">				else if (celda.startsWith(&quot;Cor&quot;) || celda.startsWith(&quot;Em&quot;))</span>
<span class="fc" id="L60">					colEmail = columna;</span>
<span class="fc bfc" id="L61" title="All 2 branches covered.">				else if (celda.startsWith(&quot;Fec&quot;))</span>
<span class="fc" id="L62">					colBirth = columna;</span>
<span class="fc bfc" id="L63" title="All 2 branches covered.">				else if (celda.startsWith(&quot;Dir&quot;))</span>
<span class="fc" id="L64">					colAddress = columna;</span>
<span class="fc bfc" id="L65" title="All 2 branches covered.">				else if (celda.startsWith(&quot;Nac&quot;))</span>
<span class="fc" id="L66">					colNacionalidad = columna;</span>
<span class="pc bpc" id="L67" title="1 of 4 branches missed.">				else if (celda.startsWith(&quot;DNI&quot;) || celda.startsWith(&quot;NIF&quot;))</span>
<span class="fc" id="L68">					colNif = columna;</span>
<span class="fc" id="L69">				columna++;</span>
<span class="fc" id="L70">			}</span>

<span class="fc bfc" id="L72" title="All 2 branches covered.">			while (rowIterator.hasNext()) {</span>

<span class="fc" id="L74">				row = rowIterator.next();</span>
<span class="fc bfc" id="L75" title="All 2 branches covered.">				name = row.getCell(colNombre) != null ? row.getCell(colNombre).getStringCellValue() : null;</span>
<span class="fc bfc" id="L76" title="All 2 branches covered.">				surname = row.getCell(colApellido) != null ? row.getCell(colApellido).getStringCellValue() : null;</span>

<span class="pc bpc" id="L78" title="1 of 2 branches missed.">				email = row.getCell(colEmail) != null ? row.getCell(colEmail).getStringCellValue() : null;</span>

<span class="pc bpc" id="L80" title="1 of 2 branches missed.">				birth = row.getCell(colBirth) != null ? row.getCell(colBirth).getDateCellValue() : null;</span>
<span class="fc bfc" id="L81" title="All 2 branches covered.">				address = row.getCell(colAddress) != null ? row.getCell(colAddress).getStringCellValue() : null;</span>

<span class="fc bfc" id="L83" title="All 2 branches covered.">				nationality = row.getCell(colNacionalidad) != null ? row.getCell(colNacionalidad).getStringCellValue()</span>
						: null;

<span class="pc bpc" id="L86" title="1 of 2 branches missed.">				nif = row.getCell(colNif) != null ? row.getCell(colNif).getStringCellValue() : null;</span>

<span class="fc" id="L88">				ciudadanos.add(anadirCitizen(name, surname, email, birth, address, nationality, nif));</span>

			}
<span class="fc" id="L91">		} catch (org.apache.poi.openxml4j.exceptions.NotOfficeXmlFileException e) {</span>
<span class="fc" id="L92">			throw  new CitizenException(&quot;Error en el formato del fichero&quot;);</span>


		} /*catch (InvalidFormatException e) {
			Console.print(&quot;El fichero no es un .xlsx&quot;);
			throw  new CitizenException();

<span class="nc" id="L99">		}*/ catch (Exception e) {</span>
<span class="nc" id="L100">			String[] fileName = path.split(&quot;/&quot;);</span>
<span class="nc" id="L101">			Console.print(</span>
					&quot;Ha ocurrido un error. Asegurate de que el fichero existe y que la fecha de nacimiento está puesta en el formato correcto\n&quot;);
<span class="nc" id="L103">			throw  new CitizenException();</span>

		} finally {

<span class="fc" id="L107">			try {</span>
<span class="pc bpc" id="L108" title="2 of 4 branches missed.">				if (wb != null) {</span>
<span class="pc" id="L109">					wb.close();</span>
				}
<span class="nc" id="L111">			} catch (IOException e) {</span>

<span class="fc" id="L113">			}</span>

<span class="nc" id="L115">		}</span>
		/*
		 * // Crear el fichero log String[] cachos = path.split(&quot;/&quot;); String
		 * nombreFich1 = cachos[cachos.length - 1]; String nombreFich =
		 * nombreFich1.replace(&quot;.xlsx&quot;, &quot;&quot;);
		 * 
		 * WreportP reporter = new WreportP(nombreFich, logger.toString());
		 * reporter.createErrorLogFile(); //
		 */
<span class="fc" id="L124">		return ciudadanos;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>